---
layout: photo
title: Django创建同一个模型的多个外键
tags:
  - Django
date: 2019-03-05 19:11:25
categories: Django
photos:
---
有时推荐关系记录时，可能会出现同一表中两个字段设置外键对应另外同一个表！
<!--more-->
若默认models.ForeignKey(）会报错，错误信息如下：
{% codeblock lang:python %}
	Unhandled exception in thread started by <function wrapper at 0x101f46758>
	Traceback (most recent call last):
	  File "/Users/liuxin/myworkspace/weixinmp/lib/python2.7/site-packages/django/utils/autoreload.py", line 228, in wrapper
	    fn(*args, **kwargs)
	  File "/Users/liuxin/myworkspace/weixinmp/lib/python2.7/site-packages/django/core/management/commands/runserver.py", line 124, in inner_run
	    self.check(display_num_errors=True)
	  File "/Users/liuxin/myworkspace/weixinmp/lib/python2.7/site-packages/django/core/management/base.py", line 405, in check
	    raise SystemCheckError(msg)
	django.core.management.base.SystemCheckError: SystemCheckError: System check identified some issues:
	
	ERRORS:
	wx_user.ShareHistory.recommend_user: (fields.E304) Reverse accessor for 'ShareHistory.recommend_user' clashes with reverse accessor for 'ShareHistory.share_user'.
		HINT: Add or change a related_name argument to the definition for 'ShareHistory.recommend_user' or 'ShareHistory.share_user'.
	wx_user.ShareHistory.recommend_wechat: (fields.E304) Reverse accessor for 'ShareHistory.recommend_wechat' clashes with reverse accessor for 'ShareHistory.share_wechat'.
		HINT: Add or change a related_name argument to the definition for 'ShareHistory.recommend_wechat' or 'ShareHistory.share_wechat'.
	wx_user.ShareHistory.share_user: (fields.E304) Reverse accessor for 'ShareHistory.share_user' clashes with reverse accessor for 'ShareHistory.recommend_user'.
		HINT: Add or change a related_name argument to the definition for 'ShareHistory.share_user' or 'ShareHistory.recommend_user'.
	wx_user.ShareHistory.share_wechat: (fields.E304) Reverse accessor for 'ShareHistory.share_wechat' clashes with reverse accessor for 'ShareHistory.recommend_wechat'.
		HINT: Add or change a related_name argument to the definition for 'ShareHistory.share_wechat' or 'ShareHistory.recommend_wechat'.
{% endcodeblock %}
解决方案：
{% codeblock lang:python %}
class ShareHistory(models.Model):
	share_user = models.ForeignKey(UserInfo, related_name='share_user', verbose_name='分享用户信息')
	share_wechat = models.ForeignKey(WeChatInfo, related_name='share_wechat', verbose_name='分享微信信息')
	recommend_user = models.ForeignKey(UserInfo, related_name='recommend_user', verbose_name='被推荐用户信息')
	recommend_wechat = models.ForeignKey(WeChatInfo, related_name='recommend_wechat', verbose_name='被推荐微信信息')
	share_time = models.FloatField(verbose_name='分享时间')
{% endcodeblock %}
在外键对应的字段添加 related_name=''，内容不能重复，否则会报错！