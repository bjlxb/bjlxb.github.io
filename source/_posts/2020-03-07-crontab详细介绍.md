---
2layout: photo
title: crontab详细介绍
tags:
  - Tool
date: 2020-03-07 22:23:33
categories: Tool
photos:
---
在linux和unix内核系统中经常用到的定时任务，因为经常会用到，这里做一下总结。
<!--more-->
crontab命令常见于Unix或Linux内核的操作系统之中，用于设置周期性执行的指令。
Linux系统中任务调度主要分为以下两类：
 1. 系统执行的工作：系统周期性所要执行的工作，如备份系统数据、清理缓存。
 2. 个人执行的工作：用户定期要做的工作，如每十分钟去爬取一次数据，每天去更新一下数据。

#### 一、和crontab有关的文件介绍
 1./etc/crontab文件
  系统调度的任务一般存放在/etc/crontab这个文件下，里面存放了一些系统运行的调度程序，内容如下：
```shell
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```
 2./etc/cron.deny文件 
  指定不能使用crontab 命令的用户
 3./etc/cron.allow文件
  指定能使用crontab的用户
 注：
  如果两个文件同时存在，那么/etc/cron.allow 优先。
  如果两个文件都不存在，那么只有root用户可以安排作业。

#### 二、.crontab命令语法及其各个参数含义
 1. crontab语法
```shell
crontab [-e [UserName]|-l [UserName]|-r [UserName]|-v [UserName]|File ] 
```
  注：crontab 是用来让使用者在固定时间或固定间隔执行程序，也就是类似使用者的时程表。
  -u user 是指设定指定 user 的时程表，这个前提是你必须要有其权限(比如说是 root)才能够指定他人的时程表。如果不使用 -u user 的话，就是表示设定自己的时程表。
  各个参数说明：
```shell
-e [UserName]: 执行文字编辑器来设定时程表，内定的文字编辑器是 vi
-r [UserName]: 删除目前的时程表
-l [UserName]: 列出目前的时程表
-v [UserName]:列出用户cron作业的状态
```
#### 三、crontab格式
 1.创建一个任务调度
```shell
[root@liuxin ~]# crontab -e
# 默认情况下，系统会编辑当前登录用户的crontab命令集合。
# 编辑其他用户的命令集合，使用如下命令:
[root@liuxin ~]# crontab -u username -e
```
2. 查看Crontab命令集合
```shell
[root@liuxin ~]# crontab -l
# 查看其他用户的Crontab命令集合
[root@liuxin ~]# crontab -u username -l
```
  crontab调度命令格式如下:
```shell
* * * * * command path　
// 前五个字段可以取整数值，指定何时开始工作，第六个域是字符串，即命令字段，其中包括了crontab调度执行的命令。 各个字段之间用spaces和tabs分割。
```
  调度命令的规则：

| 字段名称 | 说明                 | 取值范围 |
| -------- | -------------------- | -------- |
| 分钟     | 每小时的第几分钟执行 | 0-59     |
| 小时     | 每日的第几个小时执行 | 0-23     |
| 日期     | 每月的第几天执行     | 1-31     |
| 月历     | 每年的第几月执行     | 1-12     |
| 星期     | 每周的第几天执行     | 0-6      |
| 命令名称 | 欲执行的命令及参数   |          |

  crontab命令中的一些常用特殊符号：

| 符号 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| *    | 表示所有可能的值                                             |
| ,    | 表示指定一个列表范围                                         |
| －   | 表示一段时间范围，如在小时阶段： 1-5，就表示1点到5点         |
| /n   | 表示指定时间的间隔频率，如在小时阶段，*/1, 表示每1小时执行一次。也可写成1-23/1. |

  例：

```shell
# 1.每天 02:00 执行任务
0 2 * * * /bin/sh start.sh
# 每天凌晨过一分钟。一般用来进行备份的时间，因为此时系统负载不大。
0 * * * /bin/sh start.sh

# 2.每天 5:00和17:00执行任务
0 5,17 * * * /bin/sh start.sh

# 3.每分钟执行一次任务
* * * * *  /bin/sh start.sh
# 每隔一分钟，将系统的时间写入到/home目录下的date.txt文件里面
* * * * * date >> /home/date.txt
# >> 命令表示将结果累加到文件后面 > 命令则表示将结果覆盖文件

# 4.每周日 17:00 执行任务
0 17 * * sun  /bin/sh start.sh

# 5.每 10min 执行一次任务
*/10 * * * * /bin/sh start.sh

# 6.在特定的某几个月执行任务
* * * jan,may,aug * /bin/sh start.sh

# 7.在每周五、周日的17点执行任务
0 17 * * sun,fri /bin/sh start.sh

# 8.在某个月的第一个周日执行任务
0 2 * * sun  /bin/sh start.sh

# 9.每四个小时执行一个任务
0 */4 * * * /bin/sh start.sh

# 10.每周一、周日执行任务
0 4,17 * * sun,mon /bin/sh start.sh

# 11.每个30秒执行一次任务
我们没有办法直接通过上诉类似的例子去执行，因为最小的是1min。
但是我们可以通过如下的方法。
* * * * * /bin/sh start.sh
* * * * *  sleep 30; /bin/sh start.sh

# 12.多个任务在一条命令中配置
* * * * * /bin/sh start1.sh; /bin/sh start2.sh

# 13.每年执行一次任务
# @yearly 类似于“0 0 1 1 *”。
# 它会在每年的第一分钟内执行。
@yearly /scripts/script.sh
0 0 1 1 * /scripts/script.sh

14.系统重启时执行
@reboot /scripts/script.sh
```

#### 四、crontab系统命令

```shell
# 启动服务
service crond start
# 关闭服务
service crond stop
# 重启服务
service crond restart
# 重新载入配置
service crond reload
# 查看服务状态
service crond status
# 启动cron进程
/etc/init.d/crond start
# 开机就启动cron进程的设置命令：
# 方法一：
chkconfig --add crond
# 方法二：
rc-update add vixie-cron default
# 查看crontab是否执行的日志
tail -f /var/log/cron
```