---
layout: photo
title: Mysql数据库基础二
tags:
  - 测试
date: 2021-12-07 21:07:46
categories: 测试
photos:
---
记录Mysql数据库基础
<!--more-->
### 1、数据库的优化
1、优化索引、SQL 语句、分析慢查询; 
2、设计表的时候严格根据数据库的设计范式来设计数据库; 
3、使用缓存，把经常访问到的数据而且不需要经常变化的数据放在缓存中，能节约磁盘 IO; 
4、优化硬件;采用 SSD，使用磁盘队列技术(RAID0,RAID1,RDID5)等;
5、采用 MySQL 内部自带的表分区技术，把数据分层不同的文件，能够提高磁盘的读取效率; 
6、垂直分表;把一些不经常读的数据放在一张表里，节约磁盘 I/O; 
7、主从分离读写;采用主从复制把数据库的读操作和写入操作分离开来; 
8、分库分表分机器(数据量特别大)，主要的原理就是数据路由; 
9、选择合适的表引擎，参数上的优化;
10、进行架构级别的缓存，静态化和分布式;
11、不采用全文索引;
12、采用更快的存储方式，例如 NoSQL 存储经常访问的数据。

### 2、防止Sql注入
防止Sql注入的办法:
a、过滤掉一些常见的数据库操作关键字，或者通过系统函数来进行过滤。
b、在 PHP 配置文件中将 Register_globals=off;设置为关闭状态
c、SQL 语句书写的时候尽量不要省略小引号(tab 键上面那个)和单引号
d、提高数据库命名技巧，对于一些重要的字段根据程序的特点命名，取不易被猜到的 
e、对于常用的方法加以封装，避免直接暴漏 SQL 语句
f、开启 PHP 安全模式:Safe_mode=on;
g、打开 magic_quotes_gpc 来防止 SQL 注入
h、控制错误信息:关闭错误提示信息，将错误信息写到系统日志。
i、使用 mysqli 或 pdo 预处理。

### 3、NoSQL和关系数据库的区别
a、SQL 数据存在特定结构的表中;而 NoSQL 则更加灵活和可扩展，存储方式可以省是 JSON 文档、哈希表或者其他方式。
b、在 SQL 中，必须定义好表和字段结构后才能添加数据，例如定义表的主键(primary key)，索引(index),触发器(trigger),存储过程(stored procedure)等。表结构可以在被定义之后更新，但是如果有比较大的结构变更的话就会变得比较复杂。在 NoSQL 中，数据可以在任何时候任何地方添加，不需要
先定义表。
c、SQL 中如果需要增加外部关联数据的话，规范化做法是在原表中增加一个外键，关联外部数据表。而在NoSQL 中除了这种规范化的外部数据表做法以外，我们还能用如下的非规范化方式把外部数据直接放到原数据集中，以提 高查询效率。缺点也比较明显，更新审核人数据的时候将会比较麻烦。
d、SQL 中可以使用 JOIN 表链接方式将多个关系数据表中的数据用一条简单的查询语句查询出来。
NoSQL 暂未提供类似JOIN 的查询方式对多个数据集中的数据做查询。所以大部分NoSQL 使用非规范化的数据 存储方式存储数据。
e、SQL 中不允许删除已经被使用的外部数据，而 NoSQL 中则没有这种强耦合的概念，可以随时删除任何数据。
f、SQL 中如果多张表数据需要同批次被更新，即如果其中一张表更新失败的话其他表也不能更新成 功。这种场景可以通过事务来控制，可以在所有命令完成后再统一提交事务。而 NoSQL 中没有事务这个概念，每一个数据集的操作都是原子级的。
g、在相同水平的系统设计的前提下，因为 NoSQL 中省略了 JOIN 查询的消耗，故理论上性能上是优于 SQL 的。

### 4、MySQL与MongoDB本质之间最基本的差别
差别:数据的表示、查询、关系、事务、模式的设计和定义、速度和性能。MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源数据库系统。在高负载的情况下，添加更多的节点，可以保证服务器性能。
MongoDB 旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。
MongoDB 将数据存储为一个文档，数据结构由键值(key=>value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。
MongoDB 是一个面向文档的数据库，目前由 10gen开发并维护，它的功能丰富齐全，所以完全可以替代 MySQL。 与 MySQL 等关系型数据库相比，MongoDB 的优点如下:
1、弱一致性，更能保证用户的访问速度。
2、文档结构的存储方式，能够更便捷的获取数据。
3、内置 GridFS，支持大容量的存储。
4、内置 Sharding。
5、第三方支持丰富。(这是与其他的 NoSQL 相比，MongoDB 也具有的优势)
6、性能优越:
MongoDB 本身它还算比较年轻的一个产品，所以它的问题，就是成熟度肯定没有传统 MySQL 那么成熟稳定。所以在使用的时候:
尽量使用稳定版，不要在线上使用开发版，这是一个大原则;
  另外一点，备份很重要，MongoDB 如果出现一些异常情况，备份一定是要能跟上。除了通过传统的复制的方式来做备份，离线备份也还是要有，不管你是用什么方式，都要有一个完整的离线备份。往往最后出现了特殊情况， 它能帮助到你;另外，MongoDB 性能的一个关键点就是索引，索引是不是能有比较好的使用效率，索引是不是能够放在内存中，这样能够提升随机读写的性能。如果你的索引不能完全放在内存中，一旦出现随机读写比较高的时候，它就会频繁地进行磁盘交换，这个时候，MongoDB 的性能就会急剧下降，会出现波动。
另外，MongoDB 还有一个最大的缺点，就是它占用的空间很大，因为它属于典型空间换时间原则的类型。那么它的磁盘空间比普通数据库会浪费一些，而且到目前为止它还没有实现在线压缩功能，在 MongoDB 中频繁的进行数据增删改时，如果记录变了，例如数据大小发生了变化，这时候容易产生一些数据碎片，出现碎片引发的结果， 一个是索引会出现性能问题。
另外一个就是在一定的时间后，所占空间会莫名其妙地增大，所以要定期把数据库做修复，定期重新做索引， 这样会提升 MongoDB 的稳定性和效率。  在最新的版本里，它已经在实现在线压缩，估计应该在 2.0 版左右，应该 能够实现在线压缩，可以在后台执行现在 repair DataBase 的一些操作。
如果那样，就解决了目前困扰我们的大问题。

### 5、Mysql数据库中分页
select * from table limit (start-1)*limit,limit; 
其中 start 是页码，limit 是每页显示的条数。

### 6、数据库中倒数10条数据
Select * from 表名 order by 主键 desc limit 10

### 7、Mysql 数据库的操作
修改表-修改字段，重命名版:
alter table 表名 change 原名新名类型及约束;
alter table students change birthday birth datetime not null; 
修改表-修改字段，不重名版本:
alter table 表名 modify 列名类型和约束;
alter table students modify birth date not null 
全列插入:insert into 表名 values(...)
insert into students values(0,"郭靖", 1,"内蒙","2017-6"); 
部分插入:值的顺序与给出的列顺序对应:
insert into students(name, birthday) values("黄蓉","2017-8");
修改:update 表名 set 列 1=值 1，列 2=值 2.。where
update students set gender=0, homwtown="古墓"， where id = 5; 
备份:mysqldump -uroot -p 数据库名>python.sql,
恢复:mysql -uroot -p 数据库名< python.sql

### 8、提高数据库性能
1、对语句的优化
a、用程序中，保证在实现功能的基础上，尽量减少对数据库的访问次数;通过搜索参数，尽量减少对表的访问行数,最小化结果集，从而减轻网络负担;
b、能够分开的操作尽量分开处理，提高每次的响应速度;在数据窗口使用 SQL时，尽量把使用的索引放在选择的首列;算法的结构尽量简单;
c、查询时，不要过多地使用通配符如 SELECT * FROM T1 语句，要用到几列就选择几列如:SELECT COL1,COL2 FROM T1;
d、尽量限制结果集行数如:SELECT TOP 300 COL1,COL2,COL3 FROM T1,因为某些情况下用户是不需要那么多的数据的。
c、不要在应用中使用数据库游标，游标是非常有用的工具，但比使用常规的、面向集的 SQL 语句需要更大的开 销;按照特定顺序提取数据的查找。
2、避免使用不兼容的数据类型
例如 float 和 int、char 和 varchar、binary 和 varbinary 是不兼容的。 数据类型的不兼容可能使优化器无法执行一些本来可以进行的优化操作。
例如:
SELECT name FROM employee WHERE salary > 60000
在这条语句中,如 salary 字段是 money 型的,则优化器很难对其进行优化,因为 60000 是个整型数。我们应当在编程时将整型转化成为钱币型,而不要等到运行时转化。若在查询时强制转换，查询速度会明显减慢。 3.避免在 WHERE 子句中对字段进行函数或表达式操作。
若进行函数或表达式操作，将导致引擎放弃使用索引而进行全表扫描。 
4、避免使用!=或<>、IS NULL 或 IS NOT NULL、IN ，NOT IN 等这样的操作符 
5、尽量使用数字型字段；
6、合理使用 EXISTS,NOT EXISTS 子句；
7、尽量避免在索引过的字符数据中，使用非打头字母搜索； 
8、充分利用连接条件；
9、消除对大型表行数据的顺序存取 
10、避免困难的正规表达式
11、使用视图加速查询
12、能够用 BETWEEN的就不要用 IN
13、DISTINCT的就不用 GROUP BY
14、部分利用索引
15、能用UNION ALL 就不要用 UNION
16、不要写一些不做任何事的查询
17、尽量不要用 SELECT INTO 语句
18、必要时强制查询优化器使用某个索引
19、虽然 UPDATE、DELETE 语句的写法基本固定，但是还是对 UPDATE 语句给点建议: 
a、尽量不要修改主键字段。
b、当修改 VARCHAR 型字段时，尽量使用相同长度内容的值代替。
c、尽量最小化对于含有 UPDATE 触发器的表的 UPDATE 操作。
d、避免 UPDATE 将要复制到其他数据库的列。
e、避免 UPDATE 建有很多索引的列。
f、避免 UPDATE 在 WHERE 子句条件中的列。

### 9、存储过程和函数的区别
相同点:存储过程和函数都是为了可重复的执行操作数据库的 sql 语句的集合。
1、存储过程和函数都是一次编译，就会被缓存起来，下次使用就直接命中已经编译好的 sql 语句，不需要重复使用。减少网络交互，减少网络访问流量。
不同点:标识符不同，函数的标识符是 function，存储过程是 proceduce。
1、函数中有返回值，且必须有返回值，而过程没有返回值，但是可以通过设置参数类型(in,out)来实现多个参 数或者返回值。
2、存储函数使用 select 调用，存储过程需要使用 call 调用。
3、select语句可以在存储过程中调用，但是除了select..into 之外的 select 语句都不能在函数中使用。 4)通过 in out 参数，过程相关函数更加灵活，可以返回多个结果。

### 10、Mysql 开启 General-log 日志?
Show variables like ‘general%’; 
Set global general_log=1;
Set global general_log=0;

### 11、truncate、 delete、 drop 的区别
1、删除的是部分行 delete from 表名....where 
2、如果是清空表而且要保留主键最高值 delete from 表名 
3、如果是清空表，而且主键也彻底删除 truncate table 表名 
4、如果是彻底删除表，就有 drop table 表名
