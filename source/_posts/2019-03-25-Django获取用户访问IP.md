---
layout: photo
title: Django获取用户访问IP
tags:
  - Django
date: 2019-03-25 22:20:51
categories: Django
photos:
---
Django实际项目中，很多需要记录用户IP的操作，可以写一个通用工具类来记录IP
<!--more-->
## 正常获取IP
```python
request.META['REMOTE_ADDR']
```
#### 特殊情况无法获取真实IP
特殊情况使用REMOTE_ADDR会获取到127.0.0.1
- 网站服务器会使用ngix等代理http。
- 网站做了负载均衡。
解决方案：
- 使用HTTP_X_FORWARDED_FOR才获取用户真实IP
## 推荐代码
```python
if request.META.has_key('HTTP_X_FORWARDED_FOR'):
    ip =  request.META['HTTP_X_FORWARDED_FOR']
else:
    ip = request.META['REMOTE_ADDR']
```