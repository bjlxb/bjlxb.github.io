---
layout: photo
title: APP测试二
tags:
  - 测试
date: 2022-01-09 18:58:00
categories: 测试
photos:
---
记录一下APP测试中常用的ADB命令
<!--more-->
### 常用的ADB命令
adb --help / adb :看见帮助信息
adb start-server:启动 adb 服务
adb kill-server:关闭 adb 服务
adb devices:查看手机设备号
adb shell getpropro.build.version.release:获取系统版本 adb push 电脑 手机
adb pull 手机 电脑
adb logcat | grep(unix) 包名
adb logcat | findstr(win) 包名
adb shell :进入 shell 命令行，可以操作 Linux 命令
adb shell dumpsys window windows | grep mFocusedApp:获取包名
启动名(win:adb shell dumpsys window windows | findstr mFocusedApp)
adb install 路径/apk 文件:安装 apk 到手机上
adb uninstall 包名:卸载 app 从手机上
adb shell am start -W 包名/启动名: app 启动时间

### logcat命令日志内容保存到本地文件
输出重定向:logcat >> log_file_name

### App崩溃(闪退)
缓存垃圾过多:由于安卓系统的特性,如果长时间不清理垃圾文件.会导致越来越卡.也会出现闪退情况. 运行的程序过多,导致内存不足
应用版本兼容问题:如果应用版本太低，会导致不兼容，造成闪退。此外，有些新版本在调试中，也会造成应 用闪退。解决方法:如果是版本太旧，更新为新版本即可;如果是新版本闪退，可能是应用在改版调试，可卸载后安装旧版。
检查 APP 中访问网络的地方，组件中的 ImageView 是否可以正常的下载并显示到 app 页面上。
检查 APP 的 sdk 和手机的系统是否兼容。
在一些特定情况下的闪退,比如播放视频,在 Android5.0 升级到 Android6.0 的时候,有些系统 API 老版本有,新版本没有,到时回去对象的时候失败,报空,系统就会出现闪退问题。

### 测试监测 app 的内存使用、CPU 消耗、流量使用情况

adb shell top
Android 应用性能测试通常包括:启动时间、内存、CPU、耗电量、流量、流畅度等 根据手机的使用应用频度和强度不同，可将应用使用强度分为如下几种状态:
- 空闲状态:指启动应用后，不做任何操作或切换到后台运行的情况称为空闲状态，该情况为应用对内存的
消耗是最小的。
- 中强度状态:该情况用户使用应用的强度和时间长短不确定，相对来说使用时长偏长。
- 高强度状态:该种情况为应用内高频率的使用，用户很少达到，跑 monkey 时可认为高强度状态，该种情况常用来测试应用内存泄漏的情况测试时，可根据用户的操作习惯模拟应用使用频率和强度等级。
使用 adb 命令，手机连接电脑开启 USB 调试模式，进入 adbshell。
(1)查看 CPU 占用率
使用命令 top -m 10 -s cpu(-t 显示进程名称，-s 按指定行排序，-n 在退出前刷新几次，-d 刷新间隔，-m 显示最大数量)

参数含义:
- PID:progressidentification，应用程序 ID
- S: 进程的状态，其中 S 表示休眠，R 表示正在运行，Z 表示僵死状态，N 表示该进程优先值是负数。 
- #THR:程序当前所用的线程数
- VSS:VirtualSet Size 虚拟耗用内存(包含共享库占用的内存)
- RSS: ResidentSet Size 实际使用物理内存(包含共享库占用的内存)
- UID:UserIdentification，用户身份 ID
- Name:应用程序名称
在测试过程中，QA 需要关注对应包的 cpu 占用率，反复进行某个操作，cpu 占用过高且一直无法释放，此时可能存在风险。如果你想筛选出你自己的应用的话可以用下面命令
top -d 3| grep packageName
(2)查看内存使用情况
```
dumpsys meminfo <package_name>或 dumpsys meminfo <package_id>
```
参数含义:
- Naitve Heap Size: 从 mallinfo usmblks 获得，代表最大总共分配空间
- Native Heap Alloc: 从 mallinfo uorblks 获得，总共分配空间
- Native Heap Free: 从 mallinfo fordblks 获得，代表总共剩余空间
- Native Heap Size 约等于 Native Heap Alloc + Native Heap Free
- mallinfo 是一个 C 库， mallinfo 函数提供了各种各样的通过 C 的 malloc()函数分配的内存的统计信息。 
- Dalvik Heap Size:从 Runtime totalMemory()获得，Dalvik Heap 总共的内存大小。
- Dalvik Heap Alloc: Runtime totalMemory()-freeMemory() ，Dalvik Heap 分配的内存大小。
- Dalvik Heap Free:从 Runtime freeMemory()获得，Dalvik Heap 剩余的内存大小。
- Dalvik Heap Size 约等于 Dalvik HeapAlloc + Dalvik Heap Free
重点关注如下几个字段:
- Native/Dalvik 的 Heap 信息中的 alloc :具体在上面的第一行和第二行，它分别给出的是 JNI 层和 Java 层的内存分配情况，如果发现这个值一直增长，则代表程序可能出现了内存泄漏。
Total 的 PSS 信息:这个值就是你的应用真正占据的内存大小，通过这个信息，你可以轻松判别手机中哪些程序占内存比较大了。

### 弱网测试怎么测
弱网环境测试主要依赖于弱网环境的模拟。
环境搭建方式一般有两种:软件方式和硬件方式。
软件方式的成本低，主要就是通过模拟网络参数来配置弱网环境，通常来讲可以达到测试目的，一般可通过热点共享设置。
在各类网 络软件中，主要就是对带宽、丢包、延时等进行模拟弱网环境。
如果要求更接近弱网环境，比如现在很多的专项测试，会更倾向于通过硬件方式来协助测试，但这种方式相对会麻烦很多，一般会由网维协助搭建。
当然，对于有些 无法模拟的情况，只能靠人工移动到例如电梯、地铁等信号比较弱的地方。
