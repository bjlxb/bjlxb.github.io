---
layout: photo
title: mysql查询结果拼接组合
tags:
  - DB
date: 2022-04-17 19:48:12
categories: DB
photos:
---
记录一下sql语句查询结果，多个列拼接成一个列的实现方案！
<!--more-->
### concat()函数
功能：
将多个字符串连接成一个字符串。
语法：concat(str1, str2,...)
返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。

例子：
```mysql
-- 输出格式订单号-用户ID
SELECT order_id as '订单号', customer_id as '用户ID', 
CONCAT(order_id, '-', customer_id) as '订单号+用户ID'
FROM mirror_coupon_order 
WHERE status = 10 AND create_date > '2022-01-01 00:00:00';
/*
订单号	用户ID	订单号+用户ID
7057	298389	7057-298389
7058	298389	7058-298389
7059	298389	7059-298389
7060	298283	7060-298283
7061	298283	7061-298283
7062	298283	7062-298283
7063	298283	7063-298283
*/

-- 有一行数据为null
SELECT order_id as '订单号', customer_id as '用户ID', 
CONCAT(null, customer_id) as '订单号+用户ID', 
FROM mirror_coupon_order 
WHERE status = 10 AND create_date > '2022-01-01 00:00:00';
/*
订单号	用户ID	订单号+用户ID
7057	298389	[null]
7058	298389	[null]
7059	298389	[null]
7060	298283	[null]
7061	298283	[null]
7062	298283	[null]
7063	298283	[null]
*/
```


### concat_ws()函数
功能：
和concat()一样，将多个字符串连接成一个字符串，但是可以一次性指定分隔符～（concat_ws就是concat with separator）
语法：
concat_ws(separator, str1, str2, ...)
说明：
第一个参数指定分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null。

例子：
```mysql
-- 逗号分割
SELECT order_id as '订单号', customer_id as '用户ID', 
CONCAT_WS(',', order_id, customer_id) as '订单号+用户ID'
FROM mirror_coupon_order 
WHERE status in (10, 40, 45, 50) AND create_date > '2022-01-01 00:00:00';
/*
订单号	用户ID	订单号+用户ID
7057	298389	7057,298389
7058	298389	7058,298389
7059	298389	7059,298389
7060	298283	7060,298283
7061	298283	7061,298283
7062	298283	7062,298283
7063	298283	7063,298283
7064	298283	7064,298283
7065	298283	7065,298283
7066	298283	7066,298283
*/
-- 一列为null
SELECT order_id as '订单号', customer_id as '用户ID', 
CONCAT_WS('', null, customer_id) as '订单号+用户ID'
FROM mirror_coupon_order 
WHERE status in (10, 40, 45, 50) AND create_date > '2022-01-01 00:00:00';
/*
订单号	用户ID	订单号+用户ID
7057	298389	298389
7058	298389	298389
7059	298389	298389
7060	298283	298283
7061	298283	298283
7062	298283	298283
7063	298283	298283
7064	298283	298283
7065	298283	298283
7066	298283	298283
*/
```

### group_concat()函数
在有group by的查询语句中，select指定的字段要么就包含在group by语句的后面，作为分组的依据，要么就包含在聚合函数中。

功能：
将group by产生的同一个分组中的值连接起来，返回一个字符串结果。
语法：
group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator '分隔符'] )
说明：
通过使用distinct可以排除重复值；如果希望对结果中的值进行排序，可以使用order by子句；separator是一个字符串值，缺省为一个逗号。

例子：
```mysql
-- 按照用户ID进行聚合
SELECT order_id as '订单号', customer_id as '用户ID', 
group_concat(order_id order by order_id separator ', ' ) as '订单号聚合'
FROM mirror_coupon_order 
WHERE status in (10, 40, 45, 50) AND create_date > '2022-01-01 00:00:00'
group by customer_id;
/*
订单号	用户ID	订单号聚合
7947	57	7947, 7948, 7949, 7950, 7954, 7955, 7956
7356	71	7356, 8066, 8067, 8077, 8213, 8214, 8215
7238	109	7238, 7379
8245	298200	8245, 8249, 8250, 8251, 8253, 8254, 8281
7275	298206	7275, 7282, 7363, 7399, 7689, 7690, 7691
7607	298223	7607, 7608, 7612, 7644, 7645, 7670
7072	298229	7072, 7073, 7074, 7075, 7077, 7084
7324	298233	7324, 7400, 7401, 7402, 7403, 7404
7394	298247	7394, 7395, 7397, 7408, 7413, 7423
7263	298256	7263, 7264, 7265, 7743, 7753, 7754
*/

```