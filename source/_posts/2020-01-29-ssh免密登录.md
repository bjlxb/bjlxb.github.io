---
layout: photo
title: ssh免密登录
tags:
  - Tool
date: 2020-01-29 18:20:38
categories: Tool
photos:
---

使用linux免密登录会比较安全并且无需密码，方便快捷，记录一下设置过程！

<!--more-->

#### 1. 生成ssh keys

可以查看该文章：[生成SSH keys](https://bjlxb.github.io/2019/03/20/生成SSH-keys/)

#### 2. 将公钥上传至服务器

```shell
ssh-copy-id user@host
```

查看公钥是否上传至服务器

```shell
cat ~/.ssh/authorized_keys
```

修改权限信息，若不修改可能会因为权限问题，登录失败

```shell
~/.ssh目录的权限为700，
~/.ssh/authorized_keys和私钥的权限为600
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
# chmod 644 ~/.ssh/authorized_keys
```

linux系统中,文件或目录的权限可以分为3种:

r: 4 读

w: 2 写

x: 1 执行(运行)

－: 对应数值 0

数字 4 、2 和 1表示读、写、执行权限

rwx = 4 + 2 + 1 = 7 (可读写运行）

rw = 4 + 2 = 6 （可读写不可运行）

rx = 4 +1 = 5 （可读可运行不可写）

#### 3. 配置ssh服务器配置文件

使用root用户修改/etc/ssh/sshd_config文件

1. 修改内容：
```
# 若不允许root登录
PermitRootLogin no
# 允许root登录
PermitRootLogin yes
# 需要修改为no的内容
UsePAM no
PasswordAuthentication no
# 需要修改为yes的内容
RSAAuthentication yes
PubkeyAuthentication yes
```

2. 重启sshd服务
```shell
systemctl restart sshd.service
systemctl status sshd.service #查看ssh服务的状态
#systemctl start sshd.service  #开启ssh服务
#sytemctl enable sshd.service #ssh服务随开机启动，还有个disabled
#systemctl stop sshd.ervice #停止
```

   

注：

若修改后免密连接出现Permission denied (publickey,gssapi-keyex,gssapi-with-mic)错误。

1. 确认服务器~/.ssh/authorized_keys文件中是否包含本地的公钥。
2. 确认服务器~/.ssh和~/.ssh/authorized_keys文件的权限是否设置正确。
3. 确认修改/etc/ssh/sshd_config文件后是否重启了ssh服务。