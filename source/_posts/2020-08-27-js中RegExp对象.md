---
layout: photo
title: js中RegExp对象
tags:
  - 前端
date: 2020-08-27 21:38:51
categories: 前端
photos:
---
js中经常使用到正则表达式，记录下RegExp对象的使用。
<!--more-->
#### 新建正则表达式
一 使用字面量
```javascript
var regex = /xyz/;
```
二 使用RegExp构造函数
```javascript
var regex = new RegExp('xyz');
```
两种写法是等价的，都新建了一个内容为xyz的正则表达式对象。
区别为：
第一种方法在引擎编译代码时，会新建正则表达式，第二种方法在运行时新建正则表达式，所以前者的效率较高。
由于前者比较便利和直观，所以在实际应用中都采用字面量来定义正则表达式。

RegExp构造函数还可以接受第二个参数，表示修饰符。
```javascript
var regex = new RegExp('xyz', 'i');
// 等价于
var regex = /xyz/i;
```
#### 实例属性
正则对象的实例属性分成两类。

一、修饰符相关
  用于了解设置了什么修饰符。

- RegExp.prototype.ignoreCase：返回一个布尔值，表示是否设置了i修饰符。
- RegExp.prototype.global：返回一个布尔值，表示是否设置了g修饰符。
- RegExp.prototype.multiline：返回一个布尔值，表示是否设置了m修饰符。
- RegExp.prototype.flags：返回一个字符串，包含了已经设置的所有修饰符，按字母排序。
```javascript
// 四个属性都是只读的
var r = /abc/igm;

r.ignoreCase 
// true
r.global 
// true
r.multiline 
// true
r.flags 
// 'gim'
```
二、与修饰符无关属性
- RegExp.prototype.lastIndex：返回一个整数，表示下一次开始搜索的位置。该属性可读写，但是只在进行连续搜索时有意义，详细介绍请看后文。
- RegExp.prototype.source：返回正则表达式的字符串形式（不包括反斜杠），该属性只读。
```javascript
var r = /abc/igm;

r.lastIndex 
// 0
r.source 
// "abc"
```
#### 实例方法
1. RegExp.prototype.test()
    正则实例对象的test方法返回一个布尔值，表示当前模式是否能匹配参数字符串。
```javascript
// 验证参数字符串之中是否包含cat，结果返回true。

/cat/.test('cats and dogs') 
// true
```
如果正则表达式带有g修饰符，则每一次test方法都从上一次结束的位置开始向后匹配。
```javascript
var r = /b/g;
var s = 'abcabc';

r.lastIndex 
// 0
r.test(s) 
// true

r.lastIndex 
// 2
r.test(s) 
// true

r.lastIndex 
// 5
r.test(s) 
// false
```
上述代码中正则表达式使用了g修饰符，表示是全局搜索，会出现多个结果。
三次使用test方法，**每次开始搜索的位置都是上一次匹配的下一个位置**。

使用带有g修饰符，可以通过正则对象的lastIndex属性指定开始搜索的位置。
```javascript
var r = /b/g;
var s = 'abcabc';

r.lastIndex = 5;
r.test(s) 
// false

r.lastIndex 
// 0
r.test(s)
// true
```
上述代码指定从字符串的第六个位置开始搜索，这个位置为空，所以返回false。
同时，lastIndex属性重置为0，所以第二次执行r.test(s)会返回true。

注：带有g修饰符时，正则表达式内部会记住上一次的lastIndex属性，如果这时更换所要匹配的字符串，会出现难以察觉的错误。
```javascript
var r = /bb/g;
r.test('bb') 
// true

r.lastIndex
// 2

r.test('-bb-') 
// false
```
上述代码，由于正则表达式r是从上一次的lastIndex位置开始匹配，导致第二次执行test方法时出现预期之外的结果。

lastIndex属性只对同一个正则表达式有效
```javascript
var count = 0;
while (/a/g.test('babaa')) count++;
```
上述代码会无限循环，因为while循环的每次匹配条件都是一个新的正则表达式，导致lastIndex属性总是等于0。

如果正则模式是一个空字符串，则匹配所有字符串。
```javascript
new RegExp('').test('abc')
// true
```




消除字符串首尾空格

```javascript
var str = '  #id div.class  ';

str.replace(/^\s+|\s+$/g, '')
// "#id div.class"
```



<img src="/image/">

